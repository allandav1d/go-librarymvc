{{define "modals"}}

<!-- Add Book Modal -->
<div id="addBookModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Adicionar Novo Livro</h3>
            <span class="close" onclick="closeModal('addBookModal')">&times;</span>
        </div>
        <div class="modal-body">
            <form method="POST" action="/books" id="addBookForm">
                <div class="space-y-4">
                    <div>
                        <label class="form-label block mb-2">Título</label>
                        <input type="text" class="form-input" name="title" placeholder="Digite o título do livro" required>
                    </div>
                    <div>
                        <label class="form-label block mb-2">Autor</label>
                        <input type="text" class="form-input" name="author" placeholder="Digite o nome do autor" required>
                    </div>
                    <div>
                        <label class="form-label block mb-2">Tipo de Livro</label>
                        <select class="form-select" name="book_type" id="bookTypeSelect" onchange="toggleLoanDuration()" required>
                            <option value="">Selecione o tipo</option>
                            <option value="emprestavel">Emprestável</option>
                            <option value="referencia">Referência (não pode ser emprestado)</option>
                        </select>
                    </div>
                    <div id="loanDurationDiv" style="display: none;">
                        <label class="form-label block mb-2">Prazo de Empréstimo</label>
                        <select class="form-select" name="loan_duration" id="loanDurationSelect">
                            <option value="6">6 dias</option>
                            <option value="12">12 dias</option>
                            <option value="30">1 mês (30 dias)</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label block mb-2">Quantidade</label>
                        <input type="number" class="form-input" name="quantity" placeholder="Número de exemplares" min="0" required>
                    </div>
                    <div class="flex gap-3 justify-end pt-4">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addBookModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div id="addUserModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Adicionar Novo Usuário</h3>
            <span class="close" onclick="closeModal('addUserModal')">&times;</span>
        </div>
        <div class="modal-body">
            <form method="POST" action="/users">
                <div class="space-y-4">
                    <div>
                        <label class="form-label block mb-2">Nome</label>
                        <input type="text" class="form-input" name="name" placeholder="Digite o nome completo" required>
                    </div>
                    <div>
                        <label class="form-label block mb-2">Email</label>
                        <input type="email" class="form-input" name="email" placeholder="Digite o email" required>
                    </div>
                    <div class="flex gap-3 justify-end pt-4">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addUserModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Loan Modal -->
<div id="addLoanModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Novo Empréstimo</h3>
            <span class="close" onclick="closeModal('addLoanModal')">&times;</span>
        </div>
        <div class="modal-body">
            <form method="POST" action="/loans">
                <div class="space-y-4">
                    <div>
                        <label class="form-label block mb-2">Usuário</label>
                        <select class="form-select" name="user_id" required>
                            <option value="">Selecione um usuário</option>
                            {{range .Users}}
                            <option value="{{.ID}}">{{.Name}} ({{.Email}})</option>
                            {{end}}
                        </select>
                    </div>
                    <div>
                        <label class="form-label block mb-2">Livro</label>
                        <select class="form-select" name="book_id" required>
                            <option value="">Selecione um livro</option>
                            {{range .Books}}
                            {{if and (gt .Quantity 0) (eq .BookType "emprestavel")}}
                            <option value="{{.ID}}">{{.Title}} - {{.Author}} ({{.LoanDuration}} dias)</option>
                            {{end}}
                            {{end}}
                        </select>
                    </div>
                    <div class="flex gap-3 justify-end pt-4">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addLoanModal')">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Criar Empréstimo</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Open modal function
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('show');
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }
    }

    // Close modal function
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('show');
            modal.style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling
        }
    }

    // Close modal when clicking outside
    window.onclick = function (event) {
        if (event.target.classList.contains('modal')) {
            closeModal(event.target.id);
        }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const modals = document.querySelectorAll('.modal.show');
            modals.forEach(modal => {
                closeModal(modal.id);
            });
        }
    });

    // Toggle loan duration field based on book type
    function toggleLoanDuration() {
        const bookType = document.getElementById('bookTypeSelect').value;
        const loanDurationDiv = document.getElementById('loanDurationDiv');
        const loanDurationSelect = document.getElementById('loanDurationSelect');

        if (bookType === 'emprestavel') {
            loanDurationDiv.style.display = 'block';
            loanDurationSelect.required = true;
        } else {
            loanDurationDiv.style.display = 'none';
            loanDurationSelect.required = false;
            loanDurationSelect.value = '0'; // Set to 0 for reference books
        }
    }
</script>
{{end}}
